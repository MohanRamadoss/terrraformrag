{"timestamp": "20250128_155735", "query": "Setup Azure PostgreSQL database with high availability", "response": "# azurerm_terraform_postgres_ha.tf\n\n# Provider configuration with required version\nprovider \"azurerm\" {\n  version = \"~>3.0\"\n  features {}\n}\n\n# Variable definitions for configuration flexibility\nvariable \"name_prefix\" {\n  description = \"Prefix for all resource names (e.g., company or project name)\"\n  type = string\n  default = \"postgres-ha\"\n}\n\nvariable \"admin_username\" {\n  description = \"Username for PostgreSQL administrator\"\n  type = string\n  default = \"db_admin\"\n}\n\nvariable \"admin_password\" {\n  description = \"Password for PostgreSQL administrator\"\n  type = string\n  sensitive = true\n}\n\nvariable \"location\" {\n  description = \"Azure region where resources will be deployed (e.g., 'westus2')\"\n  type = string\n  default = \"westus2\"\n}\n\n# Resource group creation\nresource \"azurerm_resource_group\" \"postgres_rg\" {\n  name     = \"${var.name_prefix}-rg\"\n  location = var.location\n  \n  # Tag resources for better management and cost tracking\n  tags = {\n    Environment = \"Production\"\n    Service     = \"PostgreSQL-HA\"\n  }\n}\n\n# Virtual Network creation with subnet\nresource \"azurerm_virtual_network\" \"postgres_vnet\" {\n  name                = \"${var.name_prefix}-vnet\"\n  location            = var.location\n  resource_group_name = \"${var.name_prefix}-rg\"\n  address_space       = [\"10.0.0.0/16\"]\n  \n  tags = {\n    Environment = \"Production\"\n    Service     = \"PostgreSQL-HA\"\n  }\n}\n\nresource \"azurerm_subnet\" \"postgres subnet\" {\n  name                = \"${var.name_prefix}-subnet\"\n  vnet_name           = azurerm_virtual_network.postgres_vnet.name\n  resource_group_name = azurerm_resource_group.postgres_rg.name\n  address_prefixes     = [\"10.0.0.0/24\"]\n  \n  tags = {\n    Environment = \"Production\"\n    Service     = \"PostgreSQL-HA\"\n  }\n}\n\n# Azure PostgreSQL Managed Instance with high availability\nresource \"azurerm_postgresql_managed_instance\" \"postgres_ha\" {\n  name                = \"${var.name_prefix}-mi\"\n  location            = var.location\n  resource_group_name = azurerm_resource_group.postgres_rg.name\n  \n  # Configure high availability by enabling zone-redundant deployment\n  sku_name             = \"HA-D\"  # Specifies a zone-redundant instance\n  storage_size         = 512     # Database storage size in GB\n  \n  # Managed identity for secure authentication\n  identity {\n    type = \"SystemAssigned\"\n  }\n  \n  # Network configuration with subnet and access control\n  network {\n    subnet_id = azurerm_subnet.postgres_subnets.id\n    # Enable private endpoint by default\n    enable_private_endpoint = true\n  }\n  \n  # Database administrator credentials\n  administrator_login    = var.admin_username\n  administrator_password = var.admin_password\n  \n  # Tags for resource management\n  tags = {\n    Environment = \"Production\"\n    Service     = \"PostgreSQL-HA\"\n  }\n}\n\n# Network Security Group to control database access\nresource \"azurerm_network_security_group\" \"postgres_nsg\" {\n  name                = \"${var.name_prefix}-nsg\"\n  location            = var.location\n  resource_group_name = azurerm_resource_group.postgres_rg.name\n  \n  # Allow connections from specific sources (e.g., application servers)\n  security_rule {\n    name             = \"Allow-PostgreSQL\"\n    priority         = 100\n    protocol         = \"Tcp\"\n    source_port_range = \"*\"\n    destination_port_range = \"5432\"\n    \n    # Restrict access to a specific IP range or subnet\n    source_address_prefix = \"10.0.0.0/24\"  # Allow traffic from the same VNet\n    destination_address_prefix = \"*\" \n    access            = \"allow\"\n    direction         = \"Inbound\"\n  }\n  \n  tags = {\n    Environment = \"Production\"\n    Service     = \"PostgreSQL-HA\"\n  }\n}\n\n# Output database connection details for easy access\noutput \"connection_string\" {\n  description = \"The PostgreSQL database connection string for the admin user\"\n  value       = \"host=${azurerm_postgresql_managed_instance.postgres_ha.private_endpoint_hostname} dbname=postgres user=${var.admin_username} password=${var.admin_password}\"\n}\n\n# Output endpoint details for client connections\noutput \"private_endpoint\" {\n  description = \"Private endpoint IP and hostname for PostgreSQL instance\"\n  value       = {\n    ip          = azurerm_postgresql_managed_instance.postgres_ha.private_endpoint IPAddress,\n    hostname     = azurerm_postgresql_managed_instance.postgres_ha.private_endpoint Hostname,\n  }\n}", "model": "deepseek-r1:14b"}