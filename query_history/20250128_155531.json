{"timestamp": "20250128_155531", "query": "Setup Azure PostgreSQL database with high availability", "response": "# azure_postgresql_high_availability/README.md\n\n# azure_postgresql_high_availability/main.tf\n# Configuration for Azure PostgreSQL Database with High Availability\n# This script creates a zone-redundant PostgreSQL database in Azure.\n\nterraform {\n  required_providers {\n    azurerm = {\n      source = \"hashicorp/azurerm\"\n      version = \"~>3.0\"\n    }\n  }\n\n  # Error handling and security best practices are handled by Terraform's default behavior\n}\n\n# Variable definitions for configuration flexibility\nvariable \"admin_username\" {\n  description = \"Username for PostgreSQL admin access.\"\n  type = string\n  sensitive = true\n}\n\nvariable \"admin_password\" {\n  description = \"Password for PostgreSQL admin access.\"\n  type = string\n  sensitive = true\n}\n\nvariable \"server_name_prefix\" {\n  description = \"Prefix for the database server name (e.g., db01).\"\n  type = string\n}\n\nvariable \"resource_group_name\" {\n  description = \"Name of the resource group.\"\n  type = string\n}\n\nvariable \"location\" {\n  description = \"Azure region to deploy resources.\"\n  type = string\n}\n\nvariable \"sku_name\" {\n  description = \"The SKU name for the PostgreSQL server (HA).\"\n  type = string\n  default = \"HA-D14\"\n}\n\nvariable \"capacity\" {\n  description = \"The capacity of the PostgreSQL server in vCores.\"\n  type = number\n  default = 4\n}\n\nvariable \"storage_size\" {\n  description = \"Storage size in GB for the PostgreSQL server.\"\n  type = number\n  default = 512\n}\n\nvariable \"enable_high_availability\" {\n  description = \"Enables high availability for the PostgreSQL server.\"\n  type = bool\n  default = true\n}\n\n# Create Resource Group\nresource \"azurerm_resource_group\" \"rg\" {\n  name = var.resource_group_name\n  location = var.location\n\n  tags = {\n    environment = \"Production\"\n    cost_center = \"DatabaseServices\"\n    team = \"Infrastructure\"\n  }\n}\n\n# Create PostgreSQL Server with High Availability\nresource \"azurerm_postgresql_server\" \"db_server\" {\n  name              = \"${var.server_name_prefix}${random_suffix}\"\n  resource_group_id  = azurerm_resource_group.rg.id\n  location          = var.location\n  sku_name          = var.sku_name\n  capacity          = var.capacity\n  storage_size      = var.storage_size\n  enable_high_availability = var.enable_high_availability\n\n  tags = {\n    environment = \"Production\"\n    name        = \"PostgreSQL-HA-Server\"\n    cost_center = \"DatabaseServices\"\n  }\n\n  depends_on = [azurerm_resource_group.rg]\n}\n\n# Create PostgreSQL Database with Security Rules\nresource \"azurerm_postgresql_database\" \"db\" {\n  server_id = azurerm_postgresql_server.db_server.id\n  name     = \"production_db\"\n\n  tags = {\n    environment = \"Production\"\n    name        = \"PostgreSQL-Database\"\n  }\n\n  depends_on = [azurerm_postgresql_server.db_server]\n}\n\n# Security Rules for Database Access\nresource \"azurerm_postgresql_firewall_rule\" \"all azure services\" {\n  server_id = azurerm_postgresql_server.db_server.id\n  name     = \"AllowAllAzureServices\"\n  start_address = \"0.0.0.0\"\n  end_address   = \"0.0.0.0\"\n\n  depends_on = [azurerm_postgresql_server.db_server]\n}\n\n# Output the FQDN and connection string for easy access\noutput \"server_fqdn\" {\n  description = \"Fully qualified domain name of the PostgreSQL server.\"\n  value       = azurerm_postgresql_server.db_server.fullyQualifiedDomainName\n}\n\noutput \"connection_string\" {\n  description = \"PostgreSQL database connection string including admin credentials.\"\n  value = \"postgresql://${var.admin_username}:${var.admin_password}@${azurerm_postgresql_server.db_server.fqdn}:5432/production_db\"\n}\n\n# azure_postgresql_high_availability/variables.tf\n\n# azure_postgresql_high_availability/random_suffix.tf\nresource \"random_suffix\" \"id\" {\n  length = 8\n  minbytes = 0\n}\n\nadmin_username = \"dbadmin\"\nadmin_password = \"S0+trong@2024!\"\nserver_name_prefix = \"dbha\"\nresource_group_name = \"prod-database-rg\"\nlocation = \"eastus\"", "model": "deepseek-r1:14b"}